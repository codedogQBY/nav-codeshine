"use client"

import type React from "react"

import { useState } from "react"
import { Search, Check } from "lucide-react"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { ScrollArea } from "@/components/ui/scroll-area"
import { Popover, PopoverContent, PopoverTrigger } from "@/components/ui/popover"
import * as LucideIcons from "lucide-react" // Keep this for dynamic component access

interface IconPickerProps {
  value: string
  onChange: (iconName: string) => void
  trigger?: React.ReactNode
}

// A comprehensive list of Lucide icon names (PascalCase)
// This list is generated based on common Lucide icons.
// In a real project, this might be generated from lucide-react's internal data.
const lucideIconNames = [
  "Activity",
  "Airplay",
  "AlarmCheck",
  "AlarmClock",
  "AlarmMinus",
  "AlarmPlus",
  "AlarmX",
  "AlignCenter",
  "AlignJustify",
  "AlignLeft",
  "AlignRight",
  "Aperture",
  "Archive",
  "ArrowBigDown",
  "ArrowBigLeft",
  "ArrowBigRight",
  "ArrowBigUp",
  "ArrowDown",
  "ArrowDownCircle",
  "ArrowDownLeft",
  "ArrowDownRight",
  "ArrowLeft",
  "ArrowLeftCircle",
  "ArrowRight",
  "ArrowRightCircle",
  "ArrowUp",
  "ArrowUpCircle",
  "ArrowUpLeft",
  "ArrowUpRight",
  "AtSign",
  "Award",
  "Baby",
  "Backpack",
  "Badge",
  "BadgeAlert",
  "BadgeCheck",
  "BadgeDollarSign",
  "BadgeHelp",
  "BadgeInfo",
  "BadgeMinus",
  "BadgePercent",
  "BadgePlus",
  "BadgeX",
  "BaggageClaim",
  "Ban",
  "Banknote",
  "BarChart",
  "BarChart2",
  "BarChart3",
  "BarChart4",
  "BarChartBig",
  "BarChartHorizontal",
  "BarChartHorizontalBig",
  "Baseline",
  "Bath",
  "Battery",
  "BatteryCharging",
  "BatteryFull",
  "BatteryLow",
  "BatteryMedium",
  "BatteryWarning",
  "Beaker",
  "Bean",
  "BeanOff",
  "Bed",
  "BedDouble",
  "BedSingle",
  "Beef",
  "Beer",
  "Bell",
  "BellDot",
  "BellElectric",
  "BellMinus",
  "BellOff",
  "BellPlus",
  "BellRing",
  "BellUp",
  "BellX",
  "Bike",
  "Binary",
  "Bird",
  "Bitcoin",
  "Blinds",
  "Blocks",
  "Bluetooth",
  "BluetoothConnected",
  "BluetoothOff",
  "BluetoothSearching",
  "Bold",
  "Bomb",
  "Bone",
  "Book",
  "BookA",
  "BookAudio",
  "BookCheck",
  "BookCopy",
  "BookDashed",
  "BookDown",
  "BookHeadphones",
  "BookImage",
  "BookKey",
  "BookLock",
  "BookMarked",
  "BookMinus",
  "BookOpen",
  "BookOpenCheck",
  "BookPlus",
  "BookText",
  "BookUp",
  "BookX",
  "Bookmark",
  "BookmarkMinus",
  "BookmarkPlus",
  "BoomBox",
  "Bot",
  "Box",
  "BoxSelect",
  "Boxes",
  "Braces",
  "Brackets",
  "Brain",
  "Briefcase",
  "Brush",
  "Bug",
  "BugPlay",
  "Building",
  "Building2",
  "Bus",
  "Cake",
  "Calculator",
  "Calendar",
  "CalendarCheck2",
  "CalendarClock",
  "CalendarDays",
  "CalendarHeart",
  "CalendarMinus",
  "CalendarOff",
  "CalendarPlus",
  "CalendarRange",
  "CalendarSearch",
  "CalendarX2",
  "Camera",
  "CameraOff",
  "CandlestickChart",
  "Car",
  "CarFront",
  "CarTaxiFront",
  "Carrot",
  "CaseSensitive",
  "CassetteDisc",
  "Cast",
  "Castle",
  "Cat",
  "Check",
  "CheckCircle",
  "CheckCircle2",
  "CheckSquare",
  "ChefHat",
  "Cherry",
  "ChevronDown",
  "ChevronFirst",
  "ChevronLast",
  "ChevronLeft",
  "ChevronRight",
  "ChevronUp",
  "ChevronsDown",
  "ChevronsDownUp",
  "ChevronsLeft",
  "ChevronsLeftRight",
  "ChevronsRight",
  "ChevronsRightLeft",
  "ChevronsUp",
  "ChevronsUpDown",
  "Chrome",
  "Church",
  "Cigarette",
  "CigaretteOff",
  "Circle",
  "CircleDashed",
  "CircleDot",
  "CircleEllipsis",
  "CircleOff",
  "CircleSlash",
  "CircuitBoard",
  "Citrus",
  "Clapperboard",
  "Clipboard",
  "ClipboardCheck",
  "ClipboardCopy",
  "ClipboardList",
  "ClipboardPaste",
  "ClipboardSignature",
  "ClipboardType",
  "ClipboardX",
  "Clock",
  "Clock1",
  "Clock10",
  "Clock11",
  "Clock12",
  "Clock2",
  "Clock3",
  "Clock4",
  "Clock5",
  "Clock6",
  "Clock7",
  "Clock8",
  "Clock9",
  "Cloud",
  "CloudCog",
  "CloudDashed",
  "CloudDownload",
  "CloudDrizzle",
  "CloudFog",
  "CloudHail",
  "CloudLightning",
  "CloudMoon",
  "CloudMoonRain",
  "CloudOff",
  "CloudRain",
  "CloudRainWind",
  "CloudSnow",
  "CloudSun",
  "CloudSunRain",
  "CloudUpload",
  "Clover",
  "Code",
  "Code2",
  "Codepen",
  "Codesandbox",
  "Coffee",
  "Cog",
  "Coins",
  "Columns",
  "Combine",
  "Command",
  "Compass",
  "Component",
  "ConciergeBell",
  "Construction",
  "Contact",
  "Contact2",
  "Container",
  "Contrast",
  "Cookie",
  "Copy",
  "CopyCheck",
  "CopyMinus",
  "CopyPlus",
  "CopySlash",
  "CopyX",
  "Copyleft",
  "CornerDownLeft",
  "CornerDownRight",
  "CornerLeftDown",
  "CornerLeftUp",
  "CornerRightDown",
  "CornerRightUp",
  "CornerUpLeft",
  "CornerUpRight",
  "Cpu",
  "CreditCard",
  "Crop",
  "Cross",
  "Crosshair",
  "Crown",
  "Cuboid",
  "CupSoda",
  "Currency",
  "Database",
  "DatabaseBackup",
  "Delete",
  "Dessert",
  "Diamond",
  "Dice1",
  "Dice2",
  "Dice3",
  "Dice4",
  "Dice5",
  "Dice6",
  "Dices",
  "Diff",
  "Disc",
  "Disc2",
  "Disc3",
  "Divide",
  "DivideCircle",
  "DivideSquare",
  "Dna",
  "DnaOff",
  "Dog",
  "DollarSign",
  "DoorClosed",
  "DoorOpen",
  "Dot",
  "Download",
  "DownloadCloud",
  "Dribbble",
  "Drill",
  "Droplet",
  "Droplets",
  "Drumstick",
  "Dumbbell",
  "Ear",
  "EarOff",
  "Egg",
  "EggFried",
  "Equal",
  "EqualNot",
  "Eraser",
  "Euro",
  "Expand",
  "ExternalLink",
  "Eye",
  "EyeOff",
  "Facebook",
  "Factory",
  "Fan",
  "FastForward",
  "Feather",
  "Figma",
  "File",
  "FileArchive",
  "FileAudio",
  "FileBadge",
  "FileBadge2",
  "FileBarChart",
  "FileBarChart2",
  "FileBox",
  "FileCheck",
  "FileCheck2",
  "FileClock",
  "FileCode",
  "FileCog",
  "FileDiff",
  "FileDigit",
  "FileDown",
  "FileEdit",
  "FileHeart",
  "FileImage",
  "FileInput",
  "FileJson",
  "FileJson2",
  "FileKey",
  "FileKey2",
  "FileLock",
  "FileLock2",
  "FileMinus",
  "FileMinus2",
  "FileOutput",
  "FilePen",
  "FilePenLine",
  "FilePlus",
  "FilePlus2",
  "FileQuestion",
  "FileScan",
  "FileSearch",
  "FileSearch2",
  "FileSliders",
  "FileSpreadsheet",
  "FileStack",
  "FileSymlink",
  "FileTerminal",
  "FileText",
  "FileType",
  "FileType2",
  "FileUp",
  "FileVideo",
  "FileVolume",
  "FileWarning",
  "FileX",
  "FileX2",
  "Files",
  "Film",
  "Filter",
  "FilterX",
  "Fingerprint",
  "Fish",
  "FishOff",
  "Flag",
  "FlagOff",
  "FlagTriangleLeft",
  "FlagTriangleRight",
  "Flame",
  "Flashlight",
  "FlashlightOff",
  "Flask",
  "FlipHorizontal",
  "FlipVertical",
  "Flower",
  "FoldHorizontal",
  "FoldVertical",
  "Folder",
  "FolderArchive",
  "FolderCheck",
  "FolderClock",
  "FolderClosed",
  "FolderCog",
  "FolderDot",
  "FolderDown",
  "FolderEdit",
  "FolderGit",
  "FolderGit2",
  "FolderHeart",
  "FolderKanban",
  "FolderLock",
  "FolderMinus",
  "FolderOpen",
  "FolderOpenDot",
  "FolderPlus",
  "FolderSearch",
  "FolderSearch2",
  "FolderSymlink",
  "FolderTree",
  "FolderUp",
  "FolderX",
  "Folders",
  "Footprints",
  "Forklift",
  "FormInput",
  "Forward",
  "Frame",
  "Framer",
  "Frown",
  "FunctionSquare",
  "GalleryHorizontal",
  "GalleryHorizontalEnd",
  "GalleryVertical",
  "GalleryVerticalEnd",
  "Gamepad",
  "Gamepad2",
  "GanttChart",
  "Gauge",
  "GaugeCircle",
  "Gavel",
  "Gem",
  "Ghost",
  "Gift",
  "GitBranch",
  "GitBranchPlus",
  "GitCommit",
  "GitCompare",
  "GitFork",
  "GitGraph",
  "GitMerge",
  "GitPullRequest",
  "GitPullRequestClosed",
  "GitPullRequestDraft",
  "Github",
  "Gitlab",
  "GlassWater",
  "Glasses",
  "Globe",
  "Globe2",
  "Goal",
  "Grab",
  "GraduationCap",
  "Grape",
  "Grid",
  "Grid2X2",
  "Grid3X3",
  "Grip",
  "GripHorizontal",
  "GripVertical",
  "Group",
  "Hammer",
  "Hand",
  "HandMetal",
  "HardDrive",
  "HardDriveDownload",
  "HardDriveUpload",
  "HardHat",
  "Hash",
  "Haze",
  "HdmiPort",
  "Headphones",
  "Heart",
  "HeartCrack",
  "HeartHandshake",
  "HeartOff",
  "HeartPulse",
  "HelpCircle",
  "HelpingHand",
  "Hexagon",
  "Highlighter",
  "History",
  "Home",
  "HopOff",
  "Hop",
  "Hospital",
  "Hotel",
  "Hourglass",
  "IceCream",
  "IceCream2",
  "Image",
  "ImageMinus",
  "ImageOff",
  "ImagePlus",
  "Import",
  "Inbox",
  "Indent",
  "IndianRupee",
  "Infinity",
  "Info",
  "InspectionPanel",
  "Instagram",
  "Italic",
  "IterationCcw",
  "IterationCw",
  "JapaneseYen",
  "Joystick",
  "Kanban",
  "Key",
  "KeyRound",
  "Keyboard",
  "KeyboardOff",
  "Lamp",
  "LampCeiling",
  "LampDesk",
  "LampFloor",
  "LampWall",
  "Landmark",
  "Languages",
  "Laptop",
  "LaptopMinimal",
  "Lasso",
  "LassoSelect",
  "Laugh",
  "Layers",
  "Layout",
  "LayoutDashboard",
  "LayoutGrid",
  "LayoutList",
  "LayoutPanel",
  "LayoutTemplate",
  "Leaf",
  "Library",
  "LibraryBig",
  "LifeBuoy",
  "Lightbulb",
  "LightbulbOff",
  "LineChart",
  "Link",
  "Link2",
  "Link2Off",
  "Linkedin",
  "List",
  "ListChecks",
  "ListEnd",
  "ListFilter",
  "ListMinus",
  "ListMusic",
  "ListOrdered",
  "ListPlus",
  "ListRestart",
  "ListStart",
  "ListTodo",
  "ListTree",
  "ListVideo",
  "ListX",
  "Loader",
  "Loader2",
  "Locate",
  "LocateFixed",
  "LocateOff",
  "Lock",
  "LogIn",
  "LogOut",
  "Lollipop",
  "Luggage",
  "Mails",
  "Map",
  "MapPin",
  "MapPinOff",
  "Maximize",
  "Maximize2",
  "Medal",
  "Megaphone",
  "MegaphoneOff",
  "Meh",
  "MemoryStick",
  "Menu",
  "MenuSquare",
  "Merge",
  "MessageCircle",
  "MessageSquare",
  "MessageSquareDashed",
  "MessageSquareDot",
  "MessageSquareOff",
  "MessageSquarePlus",
  "MessageSquareText",
  "MessagesSquare",
  "Mic",
  "MicOff",
  "Microscope",
  "Milestone",
  "Minimize",
  "Minimize2",
  "Minus",
  "MinusCircle",
  "MinusSquare",
  "Monitor",
  "MonitorCheck",
  "MonitorDot",
  "MonitorDown",
  "MonitorOff",
  "MonitorPause",
  "MonitorPlay",
  "MonitorSmartphone",
  "MonitorSpeaker",
  "MonitorUp",
  "MonitorX",
  "Moon",
  "MoonStar",
  "MoreHorizontal",
  "MoreVertical",
  "Mountain",
  "MountainSnow",
  "Mouse",
  "MousePointer",
  "MousePointer2",
  "MousePointerClick",
  "MousePointerSquare",
  "MousePointerSquareDashed",
  "Move",
  "Move3d",
  "MoveDiagonal",
  "MoveDiagonal2",
  "MoveHorizontal",
  "MoveVertical",
  "Music",
  "Navigation",
  "Navigation2",
  "Navigation2Off",
  "NavigationOff",
  "Network",
  "Newspaper",
  "Nfc",
  "Nut",
  "Octagon",
  "Option",
  "Orbit",
  "Outdent",
  "Package",
  "Package2",
  "PackageCheck",
  "PackageMinus",
  "PackageOpen",
  "PackagePlus",
  "PackageSearch",
  "PackageX",
  "Palette",
  "PanelBottom",
  "PanelBottomClose",
  "PanelBottomOpen",
  "PanelLeft",
  "PanelLeftClose",
  "PanelLeftOpen",
  "PanelRight",
  "PanelRightClose",
  "PanelRightOpen",
  "PanelTop",
  "PanelTopClose",
  "PanelTopOpen",
  "Paperclip",
  "Parentheses",
  "ParkingMeter",
  "PartyPopper",
  "Pause",
  "PauseCircle",
  "PauseOctagon",
  "PawPrint",
  "PcCase",
  "Pen",
  "PenLine",
  "PenTool",
  "Pencil",
  "PencilLine",
  "PencilRuler",
  "Percent",
  "PersonStanding",
  "Phone",
  "PhoneCall",
  "PhoneForwarded",
  "PhoneIncoming",
  "PhoneMissed",
  "PhoneOff",
  "PhoneOutgoing",
  "PhonePause",
  "PhonePlus",
  "PhoneX",
  "PictureInPicture",
  "PictureInPicture2",
  "PieChart",
  "PiggyBank",
  "Pin",
  "PinOff",
  "Pipette",
  "Pizza",
  "Plane",
  "PlaneLanding",
  "PlaneTakeoff",
  "Play",
  "PlayCircle",
  "PlaySquare",
  "Plug",
  "Plug2",
  "PlugZap",
  "PlugZap2",
  "Plus",
  "PlusCircle",
  "PlusSquare",
  "Pocket",
  "PocketKnife",
  "Podcast",
  "Pointer",
  "Popcorn",
  "Popsicle",
  "Postcard",
  "Power",
  "PowerOff",
  "Printer",
  "Projector",
  "QrCode",
  "Quote",
  "Rabbit",
  "Radar",
  "Radiation",
  "Radio",
  "RadioReceiver",
  "RadioTower",
  "Rat",
  "Receipt",
  "RectangleHorizontal",
  "RectangleVertical",
  "Recycle",
  "Redo",
  "Redo2",
  "RefreshCcw",
  "RefreshCcwDot",
  "RefreshCw",
  "RefreshCwOff",
  "Refrigerator",
  "Regex",
  "RemoveFormatting",
  "Repeat",
  "Repeat1",
  "Repeat2",
  "Replace",
  "ReplaceAll",
  "Reply",
  "ReplyAll",
  "Rewind",
  "Ribbon",
  "Rocket",
  "RockingChair",
  "RollerCoaster",
  "RotateCcw",
  "RotateCcwSquare",
  "RotateCw",
  "RotateCwSquare",
  "Route",
  "RouteOff",
  "Router",
  "Rows3",
  "Rows4",
  "Rss",
  "Ruler",
  "RussianRubel",
  "Sailboat",
  "Salad",
  "Sandwich",
  "Satellite",
  "SatelliteDish",
  "Save",
  "SaveAll",
  "Scale",
  "Scale3d",
  "Scaling",
  "Scan",
  "ScanBarcode",
  "ScanEye",
  "ScanFace",
  "ScanLine",
  "ScanQr",
  "ScanText",
  "ScatterChart",
  "School",
  "Scissors",
  "ScreenShare",
  "ScreenShareOff",
  "Scroll",
  "Search",
  "SearchCheck",
  "SearchCode",
  "SearchMinus",
  "SearchPlus",
  "Send",
  "SendHorizontal",
  "SendToBack",
  "SeparatorHorizontal",
  "SeparatorVertical",
  "Server",
  "ServerCog",
  "ServerCrash",
  "ServerOff",
  "Settings",
  "Settings2",
  "Share",
  "Share2",
  "Sheet",
  "Shield",
  "ShieldAlert",
  "ShieldBan",
  "ShieldCheck",
  "ShieldClose",
  "ShieldOff",
  "ShieldQuestion",
  "ShieldX",
  "Ship",
  "Shirt",
  "ShoppingBag",
  "ShoppingCart",
  "Shovel",
  "ShowerHead",
  "Shrink",
  "Shrub",
  "Shuffle",
  "Sidebar",
  "SidebarClose",
  "SidebarOpen",
  "Sigma",
  "Signal",
  "SignalHigh",
  "SignalLow",
  "SignalMedium",
  "SignalZero",
  "Siren",
  "SkipBack",
  "SkipForward",
  "Skull",
  "Slack",
  "Slash",
  "Slice",
  "Sliders",
  "SlidersHorizontal",
  "Smartphone",
  "SmartphoneCharging",
  "SmartphoneNfc",
  "SmartphoneOff",
  "SmartphoneRound",
  "SmartphoneVibrate",
  "Smile",
  "SmilePlus",
  "Snowflake",
  "Sofa",
  "Soup",
  "Space",
  "Sparkle",
  "Sparkles",
  "Speaker",
  "Speech",
  "Spline",
  "Split",
  "SplitSquareHorizontal",
  "SplitSquareVertical",
  "SprayCan",
  "Sprout",
  "Square",
  "SquareDashedBottomCode",
  "SquareDot",
  "SquareEqual",
  "SquareStack",
  "Squirrel",
  "Stamp",
  "Star",
  "StarHalf",
  "StarOff",
  "Stars",
  "Sticker",
  "StickyNote",
  "Store",
  "StretchHorizontal",
  "StretchVertical",
  "Strikethrough",
  "Subscript",
  "Subtitles",
  "Sun",
  "SunDim",
  "SunMedium",
  "Sunrise",
  "Sunset",
  "Superscript",
  "SwatchBook",
  "SwissFranc",
  "SwitchCamera",
  "Sword",
  "Swords",
  "Syringe",
  "Table",
  "Table2",
  "TableProperties",
  "Tablet",
  "TabletSmartphone",
  "Tablets",
  "Tag",
  "Tags",
  "Target",
  "Tent",
  "Terminal",
  "TerminalSquare",
  "TestTube",
  "TestTube2",
  "TestTubes",
  "Text",
  "TextAlignCenter",
  "TextAlignJustify",
  "TextAlignLeft",
  "TextAlignRight",
  "TextCursor",
  "TextCursorInput",
  "TextQuote",
  "TextSelect",
  "Thermometer",
  "ThermometerSnowflake",
  "ThermometerSun",
  "ThumbsDown",
  "ThumbsUp",
  "Ticket",
  "Timer",
  "TimerOff",
  "TimerReset",
  "ToggleLeft",
  "ToggleRight",
  "Tornado",
  "Touchpad",
  "TouchpadOff",
  "TowerCrane",
  "Train",
  "Tram",
  "Transfer",
  "Trash",
  "Trash2",
  "TreeDeciduous",
  "TreePine",
  "Trees",
  "Trello",
  "TrendingDown",
  "TrendingUp",
  "Triangle",
  "TriangleRight",
  "Trophy",
  "Truck",
  "Turtle",
  "Tv",
  "Tv2",
  "Type",
  "Underline",
  "Undo",
  "Undo2",
  "UnfoldHorizontal",
  "UnfoldVertical",
  "Ungroup",
  "Unlock",
  "Unplug",
  "Upload",
  "UploadCloud",
  "Usb",
  "User",
  "User2",
  "UserCheck",
  "UserCog",
  "UserMinus",
  "UserPlus",
  "UserSquare",
  "UserX",
  "Users",
  "Users2",
  "Utensils",
  "UtensilsCrossed",
  "UtilityPole",
  "Variable",
  "Vegan",
  "VenetianMask",
  "Vibrate",
  "Video",
  "VideoOff",
  "View",
  "Voicemail",
  "Volume",
  "Volume1",
  "Volume2",
  "VolumeX",
  "Vote",
  "Wallet",
  "Wallet2",
  "WalletCards",
  "Wallpaper",
  "Wand",
  "Wand2",
  "Warehouse",
  "Watch",
  "Waves",
  "Webcam",
  "Webhook",
  "Weight",
  "Wheat",
  "Wifi",
  "WifiOff",
  "Wind",
  "Wine",
  "WineOff",
  "Workflow",
  "Wrench",
  "X",
  "XCircle",
  "XOctagon",
  "XSquare",
  "Youtube",
  "Zap",
  "ZapOff",
  "ZoomIn",
  "ZoomOut",
]

const getAllIcons = () => {
  // Map the names to objects containing name and component
  return lucideIconNames
    .map((name) => ({
      name,
      component: (LucideIcons as any)[name] || LucideIcons.MoreHorizontal, // Fallback to MoreHorizontal if not found
    }))
    .sort((a, b) => a.name.localeCompare(b.name))
}

// Common icon categories (using PascalCase names)
const iconCategories = {
  常用: [
    "Home",
    "User",
    "Settings",
    "Search",
    "Plus",
    "Minus",
    "Edit",
    "Trash2",
    "Save",
    "Download",
    "Upload",
    "Share",
    "Copy",
    "Check",
    "X",
    "Heart",
    "Star",
    "Info",
    "HelpCircle",
    "Bell",
  ],
  导航: [
    "ArrowLeft",
    "ArrowRight",
    "ArrowUp",
    "ArrowDown",
    "ChevronLeft",
    "ChevronRight",
    "ChevronUp",
    "ChevronDown",
    "Menu",
    "MoreHorizontal",
    "MoreVertical",
    "Navigation",
    "MapPin",
    "Globe",
  ],
  工具: [
    "Wrench",
    "Settings",
    "Cog",
    "Tool",
    "Hammer",
    "Screwdriver",
    "Paintbrush",
    "Scissors",
    "Ruler",
    "Calculator",
    "Clock",
    "Timer",
    "Gauge",
    "Sliders",
    "Filter",
    "Key",
    "Lock",
    "Unlock",
  ],
  工作: [
    "Briefcase",
    "Building",
    "Users",
    "UserCheck",
    "Calendar",
    "ClipboardList",
    "FileText",
    "Folder",
    "Archive",
    "Database",
    "Server",
    "Monitor",
    "Laptop",
    "Printer",
    "Mail",
    "MessageSquare",
  ],
  设计: [
    "Palette",
    "Brush",
    "Pen",
    "PenTool",
    "Image",
    "Camera",
    "Video",
    "Film",
    "Layers",
    "Square",
    "Circle",
    "Triangle",
    "Shapes",
    "Figma",
    "Dribbble",
  ],
  媒体: [
    "Play",
    "Pause",
    "Stop",
    "SkipForward",
    "SkipBack",
    "Volume2",
    "VolumeX",
    "Music",
    "Headphones",
    "Radio",
    "Tv",
    "Monitor",
    "Mic",
    "Film",
    "Clapperboard",
  ],
  通讯: [
    "Mail",
    "Send",
    "MessageCircle",
    "MessageSquare",
    "Phone",
    "PhoneCall",
    "Video",
    "Users",
    "UserPlus",
    "AtSign",
    "Hash",
    "Link",
    "Share2",
    "Rss",
  ],
  购物: [
    "ShoppingCart",
    "ShoppingBag",
    "CreditCard",
    "DollarSign",
    "Tag",
    "Gift",
    "Package",
    "Truck",
    "Store",
    "Receipt",
    "Wallet",
  ],
  娱乐: [
    "Gamepad2",
    "Dice1",
    "Dice6",
    "Trophy",
    "Award",
    "Star",
    "Zap",
    "Sparkles",
    "PartyPopper",
    "Coffee",
    "Pizza",
    "IceCream",
    "Popcorn",
    "Beer",
  ],
  学习: [
    "Book",
    "BookOpen",
    "GraduationCap",
    "School",
    "Library",
    "Bookmark",
    "FileText",
    "PenTool",
    "Calculator",
    "Globe",
    "Languages",
    "Lightbulb",
    "ClipboardList",
  ],
  科技: [
    "Smartphone",
    "Laptop",
    "Monitor",
    "Tablet",
    "Watch",
    "Headphones",
    "Keyboard",
    "Mouse",
    "Printer",
    "Scanner",
    "Wifi",
    "Bluetooth",
    "Usb",
    "HardDrive",
    "Cpu",
    "Server",
    "Network",
  ],
  自然: [
    "Sun",
    "Moon",
    "Cloud",
    "CloudRain",
    "Snowflake",
    "Zap",
    "Flame",
    "Droplets",
    "Wind",
    "Mountain",
    "Tree",
    "Flower",
    "Leaf",
    "Fish",
    "Bird",
    "Dog",
    "Cat",
  ],
  全部: lucideIconNames, // Add a "全部" category that includes all icons
}

export function IconPicker({ value, onChange, trigger }: IconPickerProps) {
  const [open, setOpen] = useState(false)
  const [searchQuery, setSearchQuery] = useState("")
  const [selectedCategory, setSelectedCategory] = useState("常用")

  const allIcons = getAllIcons()

  // 根据搜索和分类过滤图标
  const filteredIcons = allIcons.filter((icon) => {
    const matchesSearch = searchQuery === "" || icon.name.toLowerCase().includes(searchQuery.toLowerCase())

    const categoryIconsList = iconCategories[selectedCategory as keyof typeof iconCategories]
    const matchesCategory = selectedCategory === "全部" || (categoryIconsList && categoryIconsList.includes(icon.name))

    return matchesSearch && matchesCategory
  })

  // 获取当前选中的图标组件
  const getCurrentIcon = () => {
    const iconEntry = allIcons.find((icon) => icon.name === value)
    return iconEntry?.component || LucideIcons.MoreHorizontal
  }

  const handleIconSelect = (iconName: string) => {
    onChange(iconName)
    setOpen(false)
  }

  const CurrentIcon = getCurrentIcon()

  return (
    <Popover open={open} onOpenChange={setOpen}>
      <PopoverTrigger asChild>
        {trigger || (
          <Button variant="outline" className="w-12 h-10 p-0 bg-transparent">
            <CurrentIcon className="h-4 w-4" />
          </Button>
        )}
      </PopoverTrigger>
      <PopoverContent className="w-96 p-0" align="start">
        <div className="p-4 border-b border-slate-200 dark:border-slate-700">
          <div className="relative mb-3">
            <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-slate-400" />
            <Input
              placeholder="搜索图标..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="pl-10"
            />
          </div>

          {/* 分类选择 */}
          <div className="flex flex-wrap gap-1">
            <Button
              variant={selectedCategory === "全部" ? "default" : "outline"}
              size="sm"
              onClick={() => setSelectedCategory("全部")}
              className="text-xs h-7"
            >
              全部
            </Button>
            {Object.keys(iconCategories)
              .filter((cat) => cat !== "全部")
              .map((category) => (
                <Button
                  key={category}
                  variant={selectedCategory === category ? "default" : "outline"}
                  size="sm"
                  onClick={() => setSelectedCategory(category)}
                  className="text-xs h-7"
                >
                  {category}
                </Button>
              ))}
          </div>
        </div>

        <div className="h-80 overflow-y-auto">
          <div className="p-4">
            {filteredIcons.length > 0 ? (
              <div className="grid grid-cols-8 gap-2 min-h-0">
                {filteredIcons.slice(0, 200).map((icon) => {
                  const IconComponent = icon.component
                  const isSelected = value === icon.name

                  return (
                    <Button
                      key={icon.name}
                      variant="ghost"
                      size="sm"
                      onClick={() => handleIconSelect(icon.name)}
                      className={`h-10 w-10 p-0 relative hover:bg-slate-100 dark:hover:bg-slate-800 ${
                        isSelected ? "bg-blue-100 dark:bg-blue-900/20 border-2 border-blue-500" : ""
                      }`}
                      title={icon.name}
                    >
                      <IconComponent className="h-4 w-4" />
                      {isSelected && (
                        <Check className="absolute -top-1 -right-1 h-3 w-3 text-blue-600 bg-white dark:bg-slate-900 rounded-full" />
                      )}
                    </Button>
                  )
                })}
              </div>
            ) : (
              <div className="text-center py-8 text-slate-500 dark:text-slate-400">
                <Search className="h-8 w-8 mx-auto mb-2 opacity-50" />
                <p>未找到匹配的图标</p>
              </div>
            )}
            
            {filteredIcons.length > 200 && (
              <div className="text-center py-4 text-slate-500 dark:text-slate-400 text-sm">
                显示前 200 个图标，请使用搜索功能查找更多图标
              </div>
            )}
          </div>
        </div>

        <div className="p-3 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50">
          <p className="text-xs text-slate-500 dark:text-slate-400 text-center">共 {allIcons.length} 个图标可选择</p>
        </div>
      </PopoverContent>
    </Popover>
  )
}
